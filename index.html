<!DOCTYPE html>
<html>

<head>
  <title>Workshop Penilaian BTP 2025 Pusat Perbukuan</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>

  <main class="container">
    <h1>Selamat datang di Workshop Penilai Buku Teks Pendamping</h1>
    <div class="login-container">
      <h2>Masuk ke Workshop</h2>
      <input type="email" id="email" placeholder="Alamat E-mail">
      <input type="password" id="password" placeholder="Password">
      <button id="loginEmailBtn">Login dengan E-mail</button>


      <button id="loginBtn">dengan Google</button>

      <div class="note">
        Hanya untuk peserta terundang. <a href="#">Tidak dapat masuk?</a>
      </div>
    </div>
  </main>
  <div class="kaki">
    <footer>
      <p>Copyright Â© 2025 Faiz Alfian. All rights reserved.</p><a href="tentang.html"
        style="margin-left: 10px; border-left: 1px solid #bbb; padding-left: 10px;">Tentang Laman Ini</a>
    </footer>
  </div>

  <!-- KHUSUS SCRIPT. HATI-HATI. KHUSUS SCRIPT -->
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getAuth,
    signInWithPopup,
    GoogleAuthProvider,
    onAuthStateChanged,
    signOut,
    signInWithEmailAndPassword
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  // Konfigurasi Akun Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyD0RFRQPHoFtvZ8_DdT8gv2DCgGfC8kzQM",
    authDomain: "workshop-penilaian.firebaseapp.com",
    projectId: "workshop-penilaian",
    storageBucket: "workshop-penilaian.firebasestorage.app",
    messagingSenderId: "913053975087",
    appId: "1:913053975087:web:c8d89b4f8ea5316bea3cda",
    measurementId: "G-TWFS28040R"
  };

  // Inisialisasi Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();
  provider.setCustomParameters({ prompt: 'select_account' });

  // Daftar Akun yang Diizinkan
  let allowedEmails = [];
  fetch("orangterpilih.json")
    .then(response => response.json())
    .then(data => {
      allowedEmails = data.emails.map(email => email.toLowerCase());
      console.log("Daftar peserta berhasil dimuat:", allowedEmails);
    })
    .catch(err => console.error("Gagal memuat daftar peserta:", err));

  // Login dengan Google
  const loginBtn = document.getElementById("loginBtn");
  loginBtn.addEventListener("click", () => {
    signInWithPopup(auth, provider)
      .catch(error => alert("Login gagal: " + error.message));
  });

  // Login dengan Email & Password
  const emailBtn = document.getElementById("loginEmailBtn");
  emailBtn.addEventListener("click", () => {
    const email = document.getElementById("email").value.toLowerCase();
    const password = document.getElementById("password").value;

    signInWithEmailAndPassword(auth, email, password)
      .catch(error => alert("Login gagal: " + error.message));
  });

  // Cek apakah peserta terdaftar atau bukan
  onAuthStateChanged(auth, (user) => {
    if (user) {
      const userEmail = user.email.toLowerCase();

      if (allowedEmails.includes(userEmail)) {
        window.location.href = "dashboard.html";
      } else {
        alert("Akses ditolak. Bapak/Ibu bukan peserta workshop.");
        signOut(auth);
      }
    }
  });
</script>

  <!-- AKHIR DARI KHUSUS SCRIPT -->
</body>

</html>