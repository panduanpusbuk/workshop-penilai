<!DOCTYPE html>
<html>

<head>
  <title>Workshop Penilaian BTP 2025 Pusat Perbukuan</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>

  <main class="container">
    <h1>Selamat datang di Workshop Penilai Buku Teks Pendamping</h1>
    <div class="login-container">
      <h2>Masuk ke Workshop</h2>
      <input type="email" id="email" placeholder="Alamat Email">
      <input type="password" id="password" placeholder="Password yang Diberikan Panitia">
      <button id="loginEmailBtn">Login dengan Email & Password</button>


      <button id="loginBtn">Login dengan Akun Google</button>

      <div class="note">
        Hanya untuk peserta terundang. <a href="help-login.html">Tidak dapat masuk?</a>
      </div>
    </div>
  </main>
  <div class="kaki">
    <footer>
      <p>Copyright Â© 2025 Faiz Alfian. All rights reserved.</p><a href="tentang.html"
        style="margin-left: 10px; border-left: 1px solid #bbb; padding-left: 10px;">Tentang Laman Ini</a>
    </footer>
  </div>

  <!-- KHUSUS SCRIPT. HATI-HATI. KHUSUS SCRIPT -->
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getAuth,
    signInWithPopup,
    GoogleAuthProvider,
    onAuthStateChanged,
    signOut,
    signInWithEmailAndPassword
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  // Konfigurasi Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyD0RFRQPHoFtvZ8_DdT8gv2DCgGfC8kzQM",
    authDomain: "workshop-penilaian.firebaseapp.com",
    projectId: "workshop-penilaian",
    storageBucket: "workshop-penilaian.firebasestorage.app",
    messagingSenderId: "913053975087",
    appId: "1:913053975087:web:c8d89b4f8ea5316bea3cda",
    measurementId: "G-TWFS28040R"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();
  provider.setCustomParameters({ prompt: 'select_account' });

  // Dahulukan memuat daftar peserta
  const pesertaPromise = fetch("orangterpilih.json")
    .then(res => res.json())
    .then(data => data.emails.map(email => email.toLowerCase()))
    .catch(err => {
      console.error("Gagal memuat daftar peserta:", err);
      alert("Gagal memuat daftar peserta.");
      return [];
    });

  // Login dengan Google
  document.getElementById("loginBtn").addEventListener("click", () => {
    signInWithPopup(auth, provider)
      .catch(error => alert("Login gagal: " + error.message));
  });

  // Login dengan Email
  document.getElementById("loginEmailBtn").addEventListener("click", () => {
    const email = document.getElementById("email").value.toLowerCase();
    const password = document.getElementById("password").value;
    signInWithEmailAndPassword(auth, email, password)
      .catch(error => alert("Login gagal: " + error.message));
  });

  // Cek status login + daftar peserta
  onAuthStateChanged(auth, async (user) => {
    if (!user) return;
    const allowedEmails = await pesertaPromise;
    const userEmail = user.email.toLowerCase();

    console.log("User login:", userEmail);
    console.log("Allowed list:", allowedEmails);

    if (allowedEmails.includes(userEmail)) {
      console.log("Akses diizinkan");
      window.location.href = "dashboard.html";
    } else {
      alert("Akses ditolak. Bapak/Ibu bukan peserta workshop.");
      signOut(auth);
    }
  });
</script>


  <!-- AKHIR DARI KHUSUS SCRIPT -->
</body>

</html>