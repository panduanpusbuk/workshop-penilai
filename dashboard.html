<!DOCTYPE html>
<html>

<head>
  <title>Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
</head>

<body>
  <div id="loading-screen">
    <span>Mohon menunggu ...</span>
  </div>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-left">
      <img src="logo.png" alt="Logo Lembaga">
    </div>

    <div class="nav-center">
      Workshop Penilaian BTP | Dashboard
    </div>

    <div class="nav-right">
      <span id="userNameDisplay" style="margin-right:10px;"></span>
      <div id="onlineCounter" class="online-counter"></div>
      <a href="#" id="logoutBtn" style="color: #e90000">Logout</a>
    </div>
  </nav>
  <div class="sambutan">
    <h2 id="welcomeMessage">Halo, ...</h2>
  </div>
  <div class="container">
    <main>
      <div class="perintah-title">
        <h4>Silakan pelajari semua materi di bawah ini</h4>
      </div>
      <div class="petunjuk">
        Mulailah dari materi pertama. Materi selanjutnya akan terbuka setelah menyelesaikan video materi sebelumnya.
      </div>
      <!-- Buat catatan disclaimer di sini seperti tiap materi berdurasi 15 menit-->
      <div class="perintah">
        <ol>
          <li><a href="materi-1.html">Kriteria dan Perbedaan BTU dan BTP</a></li>
          <li><a href="materi-2.html">Penyajian Pembelajaran Mendalam</a></li>
          <li><a href="materi-3.html">Kisi-kisi Penyajian Buku beserta Contoh</a></li>
          <li><a href="materi-4.html">Legalitas, Norma, dan Etika dalam Penulisan/Penyajian BTP</a></li>
          <li><a href="materi-5.html">Instrumen Penilaian BTP</a></li>
          <li><a href="materi-6.html">Objektivitas Penilaian BTP</a></li>
          <li><a href="materi-7.html">Mekanisme Penilaian BTP</a></li>
          <li><a href="materi-8.html">Aplikasi Penilaian BTP</a></li>
          <li><a href="posttest.html">Posttest</a></li>
        </ol>
      </div>
    </main>
  </div>
  <div class="bantuan">
    <h4>Butuh bantuan? Silakan kirim pesan Whatsapp ke 0813-9328-1701 (Talitha)</h4>
  </div>
  <div class="kaki">
    <footer>
      <p>Copyright Â© 2025 Pusat Perbukuan. All rights reserved.</p>
    </footer>
  </div>
  <!-- KHUSUS SCRIPT. HATI-HATI. KHUSUS SCRIPT -->
  <!-- Script Firebase + Loading -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getDatabase, ref, onDisconnect, set, onValue, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";


    // Konfigurasi Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyD0RFRQPHoFtvZ8_DdT8gv2DCgGfC8kzQM",
      authDomain: "workshop-penilaian.firebaseapp.com",
      projectId: "workshop-penilaian",
      storageBucket: "workshop-penilaian.firebasestorage.app",
      messagingSenderId: "913053975087",
      appId: "1:913053975087:web:c8d89b4f8ea5316bea3cda",
      measurementId: "G-TWFS28040R",
      databaseURL: "https://workshop-penilaian-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };

    // Inisialisasi Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const loading = document.getElementById("loading-screen");
    const db = getDatabase(app);

    // Menampilkan jumlah user online
    const onlineDisplay = document.getElementById("onlineCounter");
    onlineDisplay.textContent = "ðŸŸ¢ Sedang memuat ...";

    // Ketika user login
    onAuthStateChanged(auth, (user) => {
      if (!user) return;

      const userRef = ref(db, `presence/${user.uid}`);

      // Tandai user online
      set(userRef, {
        email: user.email,
        lastActive: serverTimestamp()
      });

      // Kalau logout, berkurang
      onDisconnect(userRef).remove();

      // Pantau jumlah user online
      const presenceRef = ref(db, "presence");
      onValue(presenceRef, (snapshot) => {
        const usersOnline = snapshot.exists() ? Object.keys(snapshot.val()).length : 0;
        onlineDisplay.textContent = `ðŸŸ¢${usersOnline} sedang mengerjakan`;
      });
    });

    // Cek status login
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        // Belum login â†’ kembali ke index
        window.location.href = "index.html";
      } else {
        console.log("Login sebagai:", user.email);

        // Tampilkan nama user
        document.getElementById("userNameDisplay").textContent = user.displayName || user.email;

        // Welcome text
        document.getElementById("welcomeMessage").textContent =
          `Halo, ${user.displayName || user.email}`;

        // Sembunyikan loading screen perlahan
        loading.style.opacity = "0";
        setTimeout(() => (loading.style.display = "none"), 600);
      }
    });

    // Tombol Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      signOut(auth).then(() => {
        window.location.href = "index.html";
      });
    });

  </script>
  <!-- AKHIR DARI KHUSUS SCRIPT -->

</body>

</html>